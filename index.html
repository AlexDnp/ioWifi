<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable=0">
  <title>ESP8266 WebSocket Demo</title>
  <style>
    body {
      background-color: #808080;
      font-family: Arial, Helvetica, Sans-Serif;
      Color: #000000;
    }
  </style>
  <script>
    var websock;
    if (!localStorage.getItem('bgcolor')) {
      populateStorage();
    } else {
      setStyles();
    }


    function setStyles() {
      var currentColor = localStorage.getItem('bgcolor');
      var currentFont = localStorage.getItem('font');
      var currentImage = localStorage.getItem('image');

      document.getElementById('bgcolor').value = currentColor;
      document.getElementById('font').value = currentFont;
      document.getElementById('image').value = currentImage;

      htmlElem.style.backgroundColor = '#' + currentColor;
      pElem.style.fontFamily = currentFont;
      imgElem.setAttribute('src', currentImage);
    }


    function populateStorage() {
      localStorage.setItem('bgcolor', document.getElementById('bgcolor').value);
      localStorage.setItem('font', document.getElementById('font').value);
      localStorage.setItem('image', document.getElementById('image').value);

      setStyles();
    }

    function start() {
      websock = new WebSocket('ws://' + 'fan.local' + ':81/');
      websock.onopen = function (evt) { console.log('websock open'); };
      websock.onclose = function (evt) { console.log('websock close'); };
      websock.onerror = function (evt) { console.log(evt); };
      websock.onmessage = function (evt) {
        console.log(evt);
        var e = document.getElementById('ledstatus');
        if (evt.data === 'ledon') {
          e.style.color = 'red';
        }
        else if (evt.data === 'ledoff') {
          e.style.color = 'black';
        }
        else {
          console.log('unknown event');
        }
      };
    }
    function buttonclick(e) {
      websock.send(e.id);
    }
  </script>
</head>

<body onload="javascript:start();">
  <h1>ESP8266 WebSocket Demo</h1>
  <div>
    <label for="bgcolor">Choose background color:</label>
    <input class="color" id="bgcolor" value="FF0000">
  </div>
  <div>
    <label for="font">Choose font style:</label>
    <select id="font">
      <option value="'Open Sans Condensed', sans-serif" selected>Sans-serif</option>
      <option value="'Bitter', serif">Serif</option>
      <option value="'Ubuntu Mono'">Monospace</option>
    </select>
  </div>
  <div>
    <label for="image">Choose image:</label>
    <select id="image">
      <option value="images/firefoxos.png" selected>Firefox</option>
      <option value="images/crocodile.png">Crocodile</option>
      <option value="images/tortoise.png">Tortoise</option>
    </select>
  </div>
  <div id="ledstatus"><b>LED</b></div>
  <button id="ledon" type="button" onclick="buttonclick(this);">On</button>
  <button id="ledoff" type="button" onclick="buttonclick(this);">Off</button>
</body>

</html>